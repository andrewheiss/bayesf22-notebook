{
  "hash": "f362203f179c5390c96985d6efcd8265",
  "result": {
    "markdown": "---\ntitle: \"5: Conjugate families\"\nsubtitle: \"Exercises\"\ndate: \"September 6, 2022\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bayesrules)\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(tidybayes)\n\n# Plot stuff\nclrs <- MetBrewer::met.brewer(\"Lakota\", 6)\ntheme_set(theme_bw())\n\n# Seed stuff\nset.seed(1234)\nBAYES_SEED <- 1234\n```\n:::\n\n\n# Practice: Gamma-Poisson\n\n## 5.1: Tuning a Gamma prior\n\n$$\n\\begin{aligned}\nE(\\lambda) &= \\frac{s}{r} \\\\\n\\operatorname{Mode}(\\lambda) &= \\frac{s - 1}{r} \\\\\n\\operatorname{Var}(\\lambda) &= \\frac{s}{r^2}\n\\end{aligned}\n$$\n\n---\n\n**The most common value of λ is 4, and the mean is 7.**\n\n$$\n\\begin{cases}\n\\frac{s}{r} = 7 & [\\text{Mean}] \\\\\n\\frac{s-1}{r} = 4 & [\\text{Mode}] \\\\\n\\end{cases}\n$$\n\nSolving the system of equations gives:\n\n$$\n\\begin{aligned}\nr &= \\frac{1}{3} \\\\\ns &= \\frac{7}{3}\n\\end{aligned}\n$$\n\nOr with code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\neq_mean <- function(r) 7 * r\neq_mode <- function(r) (4 * r) + 1\n\nr <- uniroot(function(x) eq_mean(x) - eq_mode(x), c(0, 100))$root\ns <- eq_mean(r)\n\nr; s\n## [1] 0.3333333\n## [1] 2.333333\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~dgamma(., shape = 7/3, rate = 1/3), geom = \"area\",\n                fill = clrs[2]) +\n  geom_vline(xintercept = 4, linetype = \"21\", color = clrs[6]) +\n  annotate(geom = \"label\", x = 4, y = 0.01, label = \"Mode\", \n           fill = clrs[6], color = \"white\") +\n  geom_vline(xintercept = 7, linetype = \"23\", color = clrs[3]) +\n  annotate(geom = \"label\", x = 7, y = 0.01, label = \"Mean\", \n           fill = clrs[3], color = \"white\") +\n  xlim(c(0, 20))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n---\n\n**The most common value of λ is 10 and the mean is 12.**\n\n$$\n\\begin{cases}\n\\frac{s}{r} = 12 & [\\text{Mean}] \\\\\n\\frac{s-1}{r} = 10 & [\\text{Mode}] \\\\\n\\end{cases}\n$$\n\nSolving the system of equations gives:\n\n$$\n\\begin{aligned}\nr &= \\frac{1}{2} \\\\\ns &= 6\n\\end{aligned}\n$$\n\nOr with code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\neq_mean <- function(r) 12 * r\neq_mode <- function(r) (10 * r) + 1\n\nr <- uniroot(function(x) eq_mean(x) - eq_mode(x), c(0, 100))$root\ns <- eq_mean(r)\n\nr; s\n## [1] 0.5\n## [1] 6\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~dgamma(., shape = 6, rate = 0.5), geom = \"area\",\n                fill = clrs[2]) +\n  geom_vline(xintercept = 10, linetype = \"21\", color = clrs[6]) +\n  annotate(geom = \"label\", x = 10, y = 0.01, label = \"Mode\", \n           fill = clrs[6], color = \"white\") +\n  geom_vline(xintercept = 12, linetype = \"23\", color = clrs[3]) +\n  annotate(geom = \"label\", x = 12, y = 0.02, label = \"Mean\", \n           fill = clrs[3], color = \"white\") +\n  xlim(c(0, 40))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n---\n\n**The most common value of λ is 5, and the variance is 3.**\n\n$$\n\\begin{cases}\n\\frac{s-1}{r} = 5 & [\\text{Mode}] \\\\\n\\frac{s}{r^2} = 3 & [\\text{Variance}] \\\\\n\\end{cases}\n$$\n\nSolving the system of equations gives:\n\n$$\n\\begin{aligned}\nr &= \\frac{5 \\pm \\sqrt{37}}{6} \\\\\ns &= \\frac{31 \\pm 5\\sqrt{37}}{6}\n\\end{aligned}\n$$\n\nlol k\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- (5 + sqrt(37)) / 6\ns <- (31 + 5*sqrt(37)) / 6\n\nr; s\n## [1] 1.847127\n## [1] 10.23564\n```\n:::\n\n\nYep, it works:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(round(rgamma(10000, shape = s, rate = r)))\n## \n##    1    2    3    4    5    6    7    8    9   10   11   12   13 \n##    2  149  845 1871 2427 2108 1338  692  355  143   42   22    6\nvar(rgamma(10000, shape = s, rate = r))\n## [1] 3.013767\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~dgamma(., shape = s, rate = r), geom = \"area\",\n                fill = clrs[2]) +\n  geom_vline(xintercept = 5, linetype = \"21\", color = clrs[6]) +\n  annotate(geom = \"label\", x = 5, y = 0.01, label = \"Mode\",\n           fill = clrs[6], color = \"white\") +\n  xlim(c(0, 12))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n---\n\nAnd so on… I get the point :)\n\n\n## 5.2: Poisson likelihood functions\n\nFrom equation 5.6 in Bayes Rules:\n\n$$\nL(\\lambda \\mid \\vec{y}) ~ \\propto ~ \\lambda^{\\sum y_i}e^{-n\\lambda}\n$$\n\nIn code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nL <- function(lambda, sum_y, n) lambda^sum_y * exp(-n * lambda)\n```\n:::\n\n\n\n**(3, 7, 19)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(3, 7, 19)\nn <- length(observed_data)\nsum_y <- sum(observed_data)\n```\n:::\n\n\n- $n$ = 3\n- $\\sum y_i$ = 29\n\n$$\nL(\\lambda \\mid \\vec{y}) ~ \\propto ~ \\lambda^{29} e^{-3\\lambda}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~L(., sum_y, n), geom = \"area\", fill = clrs[1]) +\n  xlim(c(0, 20))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n---\n\n**(12, 12, 12, 0)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(12, 12, 12, 0)\nn <- length(observed_data)\nsum_y <- sum(observed_data)\n```\n:::\n\n\n- $n$ = 4\n- $\\sum y_i$ = 36\n\n$$\nL(\\lambda \\mid \\vec{y}) ~ \\propto ~ \\lambda^{36} e^{-4\\lambda}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~L(., sum_y, n), geom = \"area\", fill = clrs[1]) +\n  xlim(c(0, 20))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n---\n\n**(12)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(12)\nn <- length(observed_data)\nsum_y <- sum(observed_data)\n```\n:::\n\n\n- $n$ = 1\n- $\\sum y_i$ = 12\n\n$$\nL(\\lambda \\mid \\vec{y}) ~ \\propto ~ \\lambda^{12} e^{-\\lambda}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~L(., sum_y, n), geom = \"area\", fill = clrs[1]) +\n  xlim(c(0, 30))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n---\n\n**(16, 10, 17, 11, 11)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(16, 10, 17, 11, 11)\nn <- length(observed_data)\nsum_y <- sum(observed_data)\n```\n:::\n\n\n- $n$ = 5\n- $\\sum y_i$ = 65\n\n$$\nL(\\lambda \\mid \\vec{y}) ~ \\propto ~ \\lambda^{65} e^{-5\\lambda}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~L(., sum_y, n), geom = \"area\", fill = clrs[1]) +\n  xlim(c(0, 20))\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## 5.3: Gamma-Poisson posteriors\n\nPrior:\n\n$$\n\\lambda \\sim \\operatorname{Gamma}(24, 2)\n$$\n\nModel:\n\n$$\n\\begin{aligned}\nY_i \\mid \\lambda &\\stackrel{\\text{ind}}{\\sim} \\operatorname{Poisson}(\\lambda) \\\\\n\\lambda &\\sim \\operatorname{Gamma}(s, r)\n\\end{aligned}\n$$\n\nConjugate posterior:\n\n$$\n\\lambda \\mid y \\sim \\operatorname{Gamma}(s + \\sum y_i,\\quad r + n)\n$$\n\n**(3, 7, 19)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(3, 7, 19)\n```\n:::\n\n\n- $n$ = 3\n- $\\sum y_i$ = 29\n\n$$\n\\begin{aligned}\n\\lambda \\mid y &\\sim \\operatorname{Gamma}(s + \\sum y_i,\\quad r + n) \\\\\n\\lambda \\mid (3, 7, 19) &\\sim \\operatorname{Gamma}(24 + 29,\\quad 2 + 3) \\\\\n&\\sim \\operatorname{Gamma}(53, 5)\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\nE(\\lambda) &= \\frac{24}{2} = 12 \\text{ from prior} \\\\\nE[\\lambda \\mid (3, 7, 19)] &= \\frac{53}{5} = 10.6 \\text{ from posterior}\n\\end{aligned}\n$$\n\n---\n\n**(12, 12, 12, 0)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(12, 12, 12, 0)\n```\n:::\n\n\n- $n$ = 4\n- $\\sum y_i$ = 36\n\n$$\n\\begin{aligned}\n\\lambda \\mid y &\\sim \\operatorname{Gamma}(s + \\sum y_i,\\quad r + n) \\\\\n\\lambda \\mid (12, 12, 12, 0) &\\sim \\operatorname{Gamma}(24 + 36,\\quad 2 + 4) \\\\\n&\\sim \\operatorname{Gamma}(60, 6)\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\nE(\\lambda) &= \\frac{24}{2} = 12 \\text{ from prior} \\\\\nE[\\lambda \\mid (12, 12, 12, 0)] &= \\frac{60}{6} = 10 \\text{ from posterior}\n\\end{aligned}\n$$\n\n---\n\n**(12)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(12)\n```\n:::\n\n\n- $n$ = 1\n- $\\sum y_i$ = 12\n\n$$\n\\begin{aligned}\n\\lambda \\mid y &\\sim \\operatorname{Gamma}(s + \\sum y_i,\\quad r + n) \\\\\n\\lambda \\mid (12) &\\sim \\operatorname{Gamma}(24 + 12,\\quad 2 + 1) \\\\\n&\\sim \\operatorname{Gamma}(36, 3)\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\nE(\\lambda) &= \\frac{24}{2} = 12 \\text{ from prior} \\\\\nE[\\lambda \\mid (12)] &= \\frac{36}{3} = 12 \\text{ from posterior}\n\\end{aligned}\n$$\n\n---\n\n**(16, 10, 17, 11, 11)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved_data <- c(16, 10, 17, 11, 11)\n```\n:::\n\n\n- $n$ = 5\n- $\\sum y_i$ = 65\n\n$$\n\\begin{aligned}\n\\lambda \\mid y &\\sim \\operatorname{Gamma}(s + \\sum y_i,\\quad r + n) \\\\\n\\lambda \\mid (16, 10, 17, 11, 11) &\\sim \\operatorname{Gamma}(24 + 65,\\quad 2 + 5) \\\\\n&\\sim \\operatorname{Gamma}(89, 7)\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\nE(\\lambda) &= \\frac{24}{2} = 12 \\text{ from prior} \\\\\nE[\\lambda \\mid (16, 10, 17, 11, 11)] &= \\frac{89}{7} = 12.714 \\text{ from posterior}\n\\end{aligned}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  stat_function(fun = ~dgamma(., shape = 24, rate = 2), \n                geom = \"area\", aes(fill = \"Gamma(24, 2) prior\"), alpha = 0.75) +\n  stat_function(fun = ~dgamma(., shape = 53, rate = 5),\n                geom = \"area\", aes(fill = \"Gamma(53, 5) posterior\"), alpha = 0.75) +\n  stat_function(fun = ~dgamma(., shape = 60, rate = 6),\n                geom = \"area\", aes(fill = \"Gamma(60, 6) posterior\"), alpha = 0.75) +\n  stat_function(fun = ~dgamma(., shape = 36, rate = 3),\n                geom = \"area\", aes(fill = \"Gamma(36, 3) posterior\"), alpha = 0.75) +\n  stat_function(fun = ~dgamma(., shape = 89, rate = 7),\n                geom = \"area\", aes(fill = \"Gamma(89, 7) posterior\"), alpha = 0.75) +\n  xlim(c(5, 25)) +\n  scale_fill_manual(values = clrs[1:5])\n```\n\n::: {.cell-output-display}\n![](05-practice_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n## 5.5 & 5.6: Text messages\n\n\n# Practice: Normal-Normal\n\n## 5.8: Normal likelihood functions\n\n## 5.9 & 5.10: Investing in stock\n\n## 5.11: Normal-normal calculation\n\n## 5.12: Control brains\n",
    "supporting": [
      "05-practice_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}